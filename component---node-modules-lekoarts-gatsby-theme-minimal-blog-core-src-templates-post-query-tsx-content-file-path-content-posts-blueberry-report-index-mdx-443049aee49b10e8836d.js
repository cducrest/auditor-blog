"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[593],{4765:function(e,t,n){n.d(t,{F:function(){return m},Z:function(){return d}});var a=n(7294),l=n(8733),o=n(795),r=n(6e3),i=n(6799),c=n(8871);var s=e=>{let{post:t}=e;return null};const u=["16px","8px","4px"].map((e=>"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"));var h=e=>{let{data:{post:t},children:n}=e;return(0,l.tZ)(r.Z,null,(0,l.tZ)(o.X6,{as:"h1",variant:"styles.h1"},t.title),(0,l.tZ)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,l.tZ)("time",null,t.date),t.tags&&(0,l.tZ)(a.Fragment,null," — ",(0,l.tZ)(i.Z,{tags:t.tags})),t.timeToRead&&" — ",t.timeToRead&&(0,l.tZ)("span",null,t.timeToRead," min read")),(0,l.tZ)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:u.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},n),(0,l.tZ)(s,{post:t}))};const m=e=>{var t,n,a;let{data:{post:o}}=e;return(0,l.tZ)(c.Z,{title:o.title,description:o.description?o.description:o.excerpt,image:o.banner?null===(t=o.banner)||void 0===t||null===(n=t.childImageSharp)||void 0===n||null===(a=n.resize)||void 0===a?void 0:a.src:void 0,pathname:o.slug,canonicalUrl:o.canonicalUrl})};function d(e){let{...t}=e;return a.createElement(h,t)}},6799:function(e,t,n){var a=n(8733),l=n(7294),o=n(1883),r=n(3494),i=n(9706);t.Z=e=>{let{tags:t}=e;const{tagsPath:n,basePath:c}=(0,r.Z)();return(0,a.tZ)(l.Fragment,null,t.map(((e,t)=>(0,a.tZ)(l.Fragment,{key:e.slug},!!t&&", ",(0,a.tZ)(o.Link,{sx:e=>{var t;return{...null===(t=e.styles)||void 0===t?void 0:t.a}},to:(0,i.Z)("/"+c+"/"+n+"/"+e.slug)},e.name)))))}},8871:function(e,t,n){var a=n(7294),l=n(1883),o=n(4232);t.Z=e=>{let{title:t="",description:n="",pathname:r="",image:i="",children:c=null,canonicalUrl:s=""}=e;const u=(0,o.Z)(),{siteTitle:h,siteTitleAlt:m,siteUrl:d,siteDescription:p,siteImage:A,author:b,siteLanguage:g}=u,f={title:t?t+" | "+h:m,description:n||p,url:""+d+(r||""),image:""+d+(i||A)};return a.createElement(a.Fragment,null,a.createElement("html",{lang:g}),a.createElement("title",null,f.title),a.createElement("meta",{name:"description",content:f.description}),a.createElement("meta",{name:"image",content:f.image}),a.createElement("meta",{property:"og:title",content:f.title}),a.createElement("meta",{property:"og:url",content:f.url}),a.createElement("meta",{property:"og:description",content:f.description}),a.createElement("meta",{property:"og:image",content:f.image}),a.createElement("meta",{property:"og:type",content:"website"}),a.createElement("meta",{property:"og:image:alt",content:f.description}),a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),a.createElement("meta",{name:"twitter:title",content:f.title}),a.createElement("meta",{name:"twitter:url",content:f.url}),a.createElement("meta",{name:"twitter:description",content:f.description}),a.createElement("meta",{name:"twitter:image",content:f.image}),a.createElement("meta",{name:"twitter:image:alt",content:f.description}),a.createElement("meta",{name:"twitter:creator",content:b}),a.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,l.withPrefix)("/favicon-32x32.png")}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,l.withPrefix)("/favicon-16x16.png")}),a.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,l.withPrefix)("/apple-touch-icon.png")}),s?a.createElement("link",{rel:"canonical",href:s}):null,c)}},8819:function(e,t,n){n.r(t),n.d(t,{Head:function(){return i.F},default:function(){return c}});var a=n(7294),l=n(1151);function o(e){const t=Object.assign({span:"span",p:"p",code:"code",a:"a",h1:"h1",h2:"h2",hr:"hr",pre:"pre"},(0,l.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBQT/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAcTpr0rjGGUkIB//xAAaEAABBQEAAAAAAAAAAAAAAAADAAECERMg/9oACAEBAAEFAotcigcTINaGrLj/xAAWEQEBAQAAAAAAAAAAAAAAAAABESD/2gAIAQMBAT8BWOP/xAAXEQEAAwAAAAAAAAAAAAAAAAABEiAh/9oACAECAQE/AYrtP//EAB0QAAECBwAAAAAAAAAAAAAAAAEAAhAREiAhUYH/2gAIAQEABj8CA2puIhlGrlv/xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAQITGB/9oACAEBAAE/IekypcPpVgGuDn7gLqslO1X11//aAAwDAQACAAMAAAAQiNBB/8QAFhEAAwAAAAAAAAAAAAAAAAAAAREg/9oACAEDAQE/EFgj/8QAFxEBAAMAAAAAAAAAAAAAAAAAAREgIf/aAAgBAgEBPxAJByn/xAAbEAEBAAIDAQAAAAAAAAAAAAABERAhADFBUf/aAAgBAQABPxDX2WnRed+ggqfcaXQiHi8Zkp2TfAuYFGdVuP/Z\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="blueberry"\n        title=""\n        src="/blog/static/a509a8dec824c28f5d1e68df403a8d11/27ec1/blueberry.jpg"\n        srcset="/blog/static/a509a8dec824c28f5d1e68df403a8d11/46946/blueberry.jpg 240w,\n/blog/static/a509a8dec824c28f5d1e68df403a8d11/27ec1/blueberry.jpg 400w"\n        sizes="(max-width: 400px) 100vw, 400px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",a.createElement(t.p,null,"Blueberry is a defi yield farming protocol. It allows users to deposit collateral into ",a.createElement(t.code,null,"Banks")," and withdraw debt tokens from it to farm yield (e.g. on Ichi).\nThe code was reviewed as part of the ",a.createElement(t.a,{href:"https://app.sherlock.xyz/audits/contests/41"},"Sherlock contest"),".\nI ranked 6th out of 284 participants in this audit. I found 2 high and 1 medium vulnerabilities I present my findings here."),"\n",a.createElement(t.h1,null,"High: Fail to accrue interests on multiple token positions"),"\n",a.createElement(t.h2,null,"Summary"),"\n",a.createElement(t.p,null,"In ",a.createElement(t.code,null,"BlueBerryBank.sol")," the functions ",a.createElement(t.code,null,"borrow"),", ",a.createElement(t.code,null,"repay"),", ",a.createElement(t.code,null,"lend"),", or ",a.createElement(t.code,null,"withdrawLend")," call ",a.createElement(t.code,null,"poke(token)")," to trigger interest accrual on concerned token, but fail to do so for other token debts of the concerned position.  This could lead to wrong calculation of position's debt and whether the position is liquidatable."),"\n",a.createElement(t.h2,null,"Vulnerability Detail"),"\n",a.createElement(t.p,null,"Whether a position is liquidatable or not is checked at the end of the ",a.createElement(t.code,null,"execute")," function, the execution should revert if the position is liquidatable."),"\n",a.createElement(t.p,null,"The calculation of whether a position is liquidatable takes into account all the different debt tokens within the position. However, the debt accrual has been triggered only for one of these tokens, the one concerned by the executed action. For other tokens, the value of ",a.createElement(t.code,null,"bank.totalDebt")," will be lower than what it should be. This results in the debt value of the position being lower than what it should be and a position seen as not liquidatable while it should be liquidatable."),"\n",a.createElement(t.h2,null,"Impact"),"\n",a.createElement(t.p,null,"Users may be able to operate on their position leading them in a virtually liquidatable state while not reverting as interests were not applied. This will worsen the debt situation of the bank and lead to overall more liquidatable positions."),"\n",a.createElement(t.h2,null,"Code Snippet"),"\n",a.createElement(t.p,null,"execute checking isLiquidatable without triggering interests:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L607"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L607")),"\n",a.createElement(t.p,null,"actions only poke one token (here for borrow):"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L709-L715"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L709-L715")),"\n",a.createElement(t.p,null,"bank.totalDebt is used to calculate a position's debt while looping over every tokens:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L451-L475"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L451-L475")),"\n",a.createElement(t.p,null,"The position's debt is used to calculate the risk:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L477-L495"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L477-L495")),"\n",a.createElement(t.p,null,"The risk is used to calculate whether a debt is liquidatable:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L497-L505"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L497-L505")),"\n",a.createElement(t.h2,null,"Tool used"),"\n",a.createElement(t.p,null,"Manual Review"),"\n",a.createElement(t.h2,null,"Recommendation"),"\n",a.createElement(t.p,null,"Review how token interests are triggered. Probably need to accrue interests on every debt token of a position at the beginning of execute."),"\n",a.createElement(t.hr),"\n",a.createElement(t.h1,null,"High: Liquidate pays out full colateral for one token repaid"),"\n",a.createElement(t.h2,null,"Summary"),"\n",a.createElement(t.p,null,"In ",a.createElement(t.code,null,"BlueBerryBank.sol"),", the ",a.createElement(t.code,null,"liquidate")," function allows any user to repay the debt of a liquidatable position for a specific token and send the collateral of the position to the liquidator. However, how it is implemented means that for a position with two debt tokens, the liquidator can fully repay the debt of only one of the tokens and receive the full collateral while they should receive only part of it."),"\n",a.createElement(t.h2,null,"Vulnerability Detail"),"\n",a.createElement(t.p,null,"Liquidate will check if a debt is liquidatable (line 517) which checks the liquidation criteria using the collateral and the debt value of every debt tokens in the position (getDebtValue line 451). However, it then only consider the debt share of a single token for repaying the debt and checking which portion of collateral to send to the liquidator (line 522 - 531)."),"\n",a.createElement(t.h2,null,"Impact"),"\n",a.createElement(t.p,null,"If a user borrowed 300 USDC with 100 ICHI collateral and 3 ICHI with 1 ICHI collateral, and becomes liquidatable (e.g. through the fall of ICHI price), anyone can repay the 3 ICHI debt and receive the full 101 ICHI collateral as reward."),"\n",a.createElement(t.h2,null,"Code Snippet"),"\n",a.createElement(t.p,null,"Liquidate function:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L511-L572"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L511-L572")),"\n",a.createElement(t.p,null,"getDebtValue, showing how it takes into account every debt token of the position:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L451-L475"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L451-L475")),"\n",a.createElement(t.h2,null,"Tool used"),"\n",a.createElement(t.p,null,"Manual Review"),"\n",a.createElement(t.p,null,"Testing:"),"\n",a.createElement("details",null,a.createElement("summary",null,"bank.test.ts"),a.createElement(t.pre,null,a.createElement(t.code,{className:"language-typescript"},"import { SignerWithAddress } from '@nomiclabs/hardhat-ethers/signers';\nimport chai, { expect } from 'chai';\nimport { BigNumber, constants, utils } from 'ethers';\nimport { ethers, upgrades } from 'hardhat';\nimport {\n\tBlueBerryBank,\n\tCoreOracle,\n\tIchiVaultSpell,\n\tIWETH,\n\tSoftVault,\n\tMockOracle,\n\tIchiLpOracle,\n\tWERC20,\n\tWIchiFarm,\n\tProtocolConfig,\n\tMockIchiVault,\n\tERC20,\n\tMockIchiV2,\n\tMockIchiFarm,\n\tHardVault\n} from '../typechain-types';\nimport { ADDRESS, CONTRACT_NAMES } from '../constant';\nimport SpellABI from '../abi/IchiVaultSpell.json';\n\nimport { solidity } from 'ethereum-waffle'\nimport { near } from './assertions/near'\nimport { roughlyNear } from './assertions/roughlyNear'\nimport { Protocol, setupProtocol } from './setup-test';\n\nchai.use(solidity)\nchai.use(near)\nchai.use(roughlyNear)\n\nconst CUSDC = ADDRESS.bUSDC;\nconst WETH = ADDRESS.WETH;\nconst USDC = ADDRESS.USDC;\nconst ICHI = ADDRESS.ICHI;\nconst ICHIV1 = ADDRESS.ICHI_FARM;\nconst ICHI_VAULT_PID = 0; // ICHI/USDC Vault PoolId\n\ndescribe('Bank', () => {\n\tlet admin: SignerWithAddress;\n\tlet alice: SignerWithAddress;\n\tlet treasury: SignerWithAddress;\n\n\tlet usdc: ERC20;\n\tlet ichi: MockIchiV2;\n\tlet ichiV1: ERC20;\n\tlet weth: IWETH;\n\tlet werc20: WERC20;\n\tlet mockOracle: MockOracle;\n\tlet ichiOracle: IchiLpOracle;\n\tlet oracle: CoreOracle;\n\tlet spell: IchiVaultSpell;\n\tlet wichi: WIchiFarm;\n\tlet bank: BlueBerryBank;\n\tlet config: ProtocolConfig;\n\tlet usdcSoftVault: SoftVault;\n\tlet ichiSoftVault: SoftVault;\n\tlet hardVault: HardVault;\n\tlet ichiFarm: MockIchiFarm;\n\tlet ichiVault: MockIchiVault;\n\tlet protocol: Protocol;\n\n\tbefore(async () => {\n\t\t[admin, alice, treasury] = await ethers.getSigners();\n\t\tusdc = <ERC20>await ethers.getContractAt(\"ERC20\", USDC);\n\t\tichi = <MockIchiV2>await ethers.getContractAt(\"MockIchiV2\", ICHI);\n\t\tichiV1 = <ERC20>await ethers.getContractAt(\"ERC20\", ICHIV1);\n\t\tweth = <IWETH>await ethers.getContractAt(CONTRACT_NAMES.IWETH, WETH);\n\n\t\tprotocol = await setupProtocol();\n\t\tconfig = protocol.config;\n\t\tbank = protocol.bank;\n\t\tspell = protocol.spell;\n\t\tichiFarm = protocol.ichiFarm;\n\t\tichiVault = protocol.ichi_USDC_ICHI_Vault;\n\t\twichi = protocol.wichi;\n\t\twerc20 = protocol.werc20;\n\t\toracle = protocol.oracle;\n\t\tmockOracle = protocol.mockOracle;\n\t\tusdcSoftVault = protocol.usdcSoftVault;\n\t\tichiSoftVault = protocol.ichiSoftVault;\n\t\thardVault = protocol.hardVault;\n\t})\n\n\tbeforeEach(async () => {\n\t})\n\n\tdescribe(\"Liquidation\", () => {\n\t\tconst depositAmount = utils.parseUnits('100', 18); // worth of $400\n\t\tconst borrowAmount = utils.parseUnits('300', 6);\n\t\tconst iface = new ethers.utils.Interface(SpellABI);\n\n\t\tbeforeEach(async () => {\n\t\t\tawait usdc.approve(bank.address, ethers.constants.MaxUint256);\n\t\t\tawait ichi.approve(bank.address, ethers.constants.MaxUint256);\n\t\t\tawait bank.execute(\n\t\t\t\t0,\n\t\t\t\tspell.address,\n\t\t\t\tiface.encodeFunctionData(\"openPosition\", [\n\t\t\t\t\t0,\n\t\t\t\t\tICHI,\n\t\t\t\t\tUSDC,\n\t\t\t\t\tdepositAmount,\n\t\t\t\t\tborrowAmount // 3x\n\t\t\t\t])\n\t\t\t)\n\n\t\t\tawait bank.execute(\n\t\t\t\t1,\n\t\t\t\tspell.address,\n\t\t\t\tiface.encodeFunctionData(\"openPosition\", [\n\t\t\t\t\t0,\n\t\t\t\t\tICHI,\n\t\t\t\t\tICHI,\n\t\t\t\t\tutils.parseUnits('1', 18),\n\t\t\t\t\tutils.parseUnits('3', 18), // 3x\n\t\t\t\t])\n\t\t\t)\n\t\t})\n\t\tit.only(\"should be able to liquidate the position => (OV - PV)/CV = LT\", async () => {\n\t\t\tawait ichiVault.rebalance(-260400, -260200, -260800, -260600, 0);\n\n\t\t\tconst positionInfoBefore = await bank.getPositionInfo(1);\n\t\t\tconsole.log(positionInfoBefore)\n\n\t\t\tconsole.log('===ICHI token dumped from $5 to $1===');\n\t\t\tawait mockOracle.setPrice(\n\t\t\t\t[ICHI],\n\t\t\t\t[\n\t\t\t\t\tBigNumber.from(10).pow(17).mul(10), // $0.5\n\t\t\t\t]\n\t\t\t);\n\n\t\t\texpect(await bank.isLiquidatable(1)).to.be.true;\n\n\t\t\tconst ichiBalanceBefore = await ichi.balanceOf(alice.address)\n\t\t\tconst aliceIchiSoftVaultBalanceBefore = await ichiSoftVault.balanceOf(alice.address)\n\n\t\t\tawait ichi.connect(alice).approve(bank.address, ethers.constants.MaxUint256)\n\t\t\tawait expect(\n\t\t\t\tbank.connect(alice).liquidate(1, ICHI, utils.parseUnits('3', 18))\n\t\t\t).to.be.emit(bank, \"Liquidate\");\n\t\t\t\n\t\t\tconst positionInfo = await bank.getPositionInfo(1);\n\t\t\tconsole.log(positionInfo)\n\n\t\t\tconst ichiBalanceAfter = await ichi.balanceOf(alice.address)\n\t\t\tconst aliceIchiSoftVaultBalanceAfter = await ichiSoftVault.balanceOf(alice.address)\n\n\t\t\texpect(positionInfo.collateralSize).to.be.lt(utils.parseUnits('1', 2))  // position is almost 0 (due to fees / rounding it's not 0)\n\t\t\texpect(positionInfoBefore.collateralSize.sub(positionInfo.collateralSize)).to.be.roughlyNear(positionInfoBefore.collateralSize)  // position is almost 0\n\n\t\t\texpect((ichiBalanceBefore.sub(ichiBalanceAfter).toString())).to.equal(utils.parseUnits('3', 18))  // alice repaid 3\n\t\t\texpect(aliceIchiSoftVaultBalanceAfter.sub(aliceIchiSoftVaultBalanceBefore)).to.be.roughlyNear(positionInfoBefore.underlyingVaultShare)  // alice received roughly all the share\n\t\t})\n\t})\n})\n"))),"\n",a.createElement(t.h2,null,"Recommendation"),"\n",a.createElement(t.p,null,"One fix is not to allow partial liquidation and only allow for liquidations if the liquidator pays out the debt for every token in the position. This comes with the challenge that positions with unpopular debt tokens are hard to liquidate, and that users may not be willing to use ",a.createElement(t.code,null,"type(uint256).max")," as repaid amount for fear of front-running transactions that may accrue additional debt, so there will always be dust amount of debts."),"\n",a.createElement(t.p,null,"The other solution is to calculate the value of debt repaid compared to the total debt and only transfer that share of collateral to the liquidator."),"\n",a.createElement(t.hr),"\n",a.createElement(t.h1,null,"Medium: Bank totalLend accounting wrong"),"\n",a.createElement(t.h2,null,"Summary"),"\n",a.createElement(t.p,null,"In ",a.createElement(t.code,null,"BlueBerryBank.sol"),", the value of ",a.createElement(t.code,null,"bank.totalLend")," is probably wrong after liquidations."),"\n",a.createElement(t.h2,null,"Vulnerability Detail"),"\n",a.createElement(t.p,null,"The value of ",a.createElement(t.code,null,"bank.totalLend")," should track the total amount lent to the bank, but liquidations do not update this value when they probably should. This value is not currently used anywhere in the code so it is hard to tell if this is definitely wrong or can be abused. However if spells are later added that rely on the correct calculation of this value for critical accounting, it will become a problem."),"\n",a.createElement(t.h2,null,"Impact"),"\n",a.createElement(t.p,null,"Currently low impact as this value is unused by other parts of the code. If the protocol intends to add spells or other functionalities that rely on this value, the impact may be higher."),"\n",a.createElement(t.h2,null,"Code Snippet"),"\n",a.createElement(t.p,null,"lend function increases bank.totalLend, pos.underlyingAmount, and deposits token to the vault :"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L620-L662"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L620-L662")),"\n",a.createElement(t.p,null,"withdrawLend function decreases bank.totalLend, pos.underlyingAmount, and removes token from the vault:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L669-L704"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L669-L704")),"\n",a.createElement(t.p,null,"liquidate function decreases pos.underlyingAmount, and transfer vault tokens to the liquidator (they no longer are held by the bank), but does not decrease bank.totalLend:"),"\n",a.createElement(t.p,null,a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L511-L572"},"https://github.com/sherlock-audit/2023-02-blueberry/blob/main/contracts/BlueBerryBank.sol#L511-L572")),"\n",a.createElement(t.h2,null,"Tool used"),"\n",a.createElement(t.p,null,"Manual Review"),"\n",a.createElement(t.h2,null,"Recommendation"),"\n",a.createElement(t.p,null,"Update this value correctly or remove it altogether."))}var r=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.ah)(),e.components);return t?a.createElement(t,e,a.createElement(o,e)):o(e)},i=n(4765);function c(e){return a.createElement(i.Z,e,a.createElement(r,e))}i.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-blueberry-report-index-mdx-443049aee49b10e8836d.js.map