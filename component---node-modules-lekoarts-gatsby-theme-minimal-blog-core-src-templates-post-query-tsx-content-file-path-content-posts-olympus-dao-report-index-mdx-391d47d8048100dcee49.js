"use strict";(self.webpackChunkminimal_blog=self.webpackChunkminimal_blog||[]).push([[295],{4765:function(e,t,n){n.d(t,{F:function(){return u},Z:function(){return h}});var a=n(7294),i=n(8733),l=n(795),o=n(6e3),r=n(6799),c=n(8871);var s=e=>{let{post:t}=e;return null};const A=["16px","8px","4px"].map((e=>"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"));var m=e=>{let{data:{post:t},children:n}=e;return(0,i.tZ)(o.Z,null,(0,i.tZ)(l.X6,{as:"h1",variant:"styles.h1"},t.title),(0,i.tZ)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,i.tZ)("time",null,t.date),t.tags&&(0,i.tZ)(a.Fragment,null," — ",(0,i.tZ)(r.Z,{tags:t.tags})),t.timeToRead&&" — ",t.timeToRead&&(0,i.tZ)("span",null,t.timeToRead," min read")),(0,i.tZ)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:A.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},n),(0,i.tZ)(s,{post:t}))};const u=e=>{var t,n,a;let{data:{post:l}}=e;return(0,i.tZ)(c.Z,{title:l.title,description:l.description?l.description:l.excerpt,image:l.banner?null===(t=l.banner)||void 0===t||null===(n=t.childImageSharp)||void 0===n||null===(a=n.resize)||void 0===a?void 0:a.src:void 0,pathname:l.slug,canonicalUrl:l.canonicalUrl})};function h(e){let{...t}=e;return a.createElement(m,t)}},6799:function(e,t,n){var a=n(8733),i=n(7294),l=n(1883),o=n(3494),r=n(9706);t.Z=e=>{let{tags:t}=e;const{tagsPath:n,basePath:c}=(0,o.Z)();return(0,a.tZ)(i.Fragment,null,t.map(((e,t)=>(0,a.tZ)(i.Fragment,{key:e.slug},!!t&&", ",(0,a.tZ)(l.Link,{sx:e=>{var t;return{...null===(t=e.styles)||void 0===t?void 0:t.a}},to:(0,r.Z)("/"+c+"/"+n+"/"+e.slug)},e.name)))))}},8871:function(e,t,n){var a=n(7294),i=n(1883),l=n(4232);t.Z=e=>{let{title:t="",description:n="",pathname:o="",image:r="",children:c=null,canonicalUrl:s=""}=e;const A=(0,l.Z)(),{siteTitle:m,siteTitleAlt:u,siteUrl:h,siteDescription:d,siteImage:p,author:g,siteLanguage:b}=A,f={title:t?t+" | "+m:u,description:n||d,url:""+h+(o||""),image:""+h+(r||p)};return a.createElement(a.Fragment,null,a.createElement("html",{lang:b}),a.createElement("title",null,f.title),a.createElement("meta",{name:"description",content:f.description}),a.createElement("meta",{name:"image",content:f.image}),a.createElement("meta",{property:"og:title",content:f.title}),a.createElement("meta",{property:"og:url",content:f.url}),a.createElement("meta",{property:"og:description",content:f.description}),a.createElement("meta",{property:"og:image",content:f.image}),a.createElement("meta",{property:"og:type",content:"website"}),a.createElement("meta",{property:"og:image:alt",content:f.description}),a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),a.createElement("meta",{name:"twitter:title",content:f.title}),a.createElement("meta",{name:"twitter:url",content:f.url}),a.createElement("meta",{name:"twitter:description",content:f.description}),a.createElement("meta",{name:"twitter:image",content:f.image}),a.createElement("meta",{name:"twitter:image:alt",content:f.description}),a.createElement("meta",{name:"twitter:creator",content:g}),a.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,i.withPrefix)("/favicon-32x32.png")}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,i.withPrefix)("/favicon-16x16.png")}),a.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,i.withPrefix)("/apple-touch-icon.png")}),s?a.createElement("link",{rel:"canonical",href:s}):null,c)}},6729:function(e,t,n){n.r(t),n.d(t,{Head:function(){return r.F},default:function(){return c}});var a=n(7294),i=n(1151);function l(e){const t=Object.assign({span:"span",p:"p",a:"a",h1:"h1",h2:"h2",hr:"hr"},(0,i.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBA//EABYBAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABqtqo4hgAH//EABoQAQACAwEAAAAAAAAAAAAAAAECEQADIDL/2gAIAQEAAQUCC1ihmv0UR4//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAbEAABBAMAAAAAAAAAAAAAAAAhAAECECAiUf/aAAgBAQAGPwIWQpbNzH//xAAbEAEAAgIDAAAAAAAAAAAAAAABESEAECBRYf/aAAgBAQABPyFABK5KKTxmNILgIk4LcWh3x//aAAwDAQACAAMAAAAQcDDD/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAQABBAMAAAAAAAAAAAAAAREhABAxYSBBkf/aAAgBAQABPxBMiIB70+cjFOnc42yRKJ4pMd6lILkEUafMeP8A/9k=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="olympusDAO"\n        title=""\n        src="/auditor-blog/static/1787cb9164449ac705caf33048739784/27ec1/olympusDAO.jpg"\n        srcset="/auditor-blog/static/1787cb9164449ac705caf33048739784/46946/olympusDAO.jpg 240w,\n/auditor-blog/static/1787cb9164449ac705caf33048739784/27ec1/olympusDAO.jpg 400w"\n        sizes="(max-width: 400px) 100vw, 400px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>'}}),"\n",a.createElement(t.p,null,"OlympusDAO intends to create a non-pegged stable coin called OHM. In this audit, we were interested by what they called the SingleSidedLiquidityVault.\nThe idea behind it is to create a vault bound to an AMM liquidity pool (e.g. Balancer), that lets users deposit pair tokens (e.g. wstETH).\nThe vault will then mint OHM tokens matching the USD value of pair tokens deposited by the user and provide liquidity to the pool in a 50/50 OHM/pair token value split.\nThe vault can deposit the LP tokens it gets from the pool and stake them to farm reward (e.g. in Aura)."),"\n",a.createElement(t.p,null,"The code was reviewed as part of the ",a.createElement(t.a,{href:"https://app.sherlock.xyz/audits/contests/50"},"Sherlock contest"),".\nI ranked 4th out of 154 participants in this audit. I found 1 high and 1 medium vulnerabilities, I present my findings here."),"\n",a.createElement(t.h1,null,"High: Abuse decreaseTotalLp for DOS"),"\n",a.createElement(t.h2,null,"Summary"),"\n",a.createElement(t.p,null,"The function decreaseTotalLp is called on withdraw of vaults and reverts if amount withdrawn exceeds total LP stored by the vault manager. This assumes that the withdrawn LP have been deposited by the user before, which may be wrong."),"\n",a.createElement(t.p,null,"A user can LP token on Balancer and reward tokens on Aura, transfer them to the vault (without using the deposit() function) and withdraw() them to break accounting. If the user lowers totalLp to 0, no other user will be able to withdraw their LP."),"\n",a.createElement(t.h2,null,"Vulnerability Detail"),"\n",a.createElement(t.p,null,"withdraw() decreases totalLP on the manager:\n",a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultLido.sol#L218"},"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultLido.sol#L218")),"\n",a.createElement(t.p,null,"The totalLP tracking assume withdrawn LP were once deposited and reverts on unexpected value:\n",a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultManagerLido.sol#L272-L280"},"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultManagerLido.sol#L272-L280")),"\n",a.createElement(t.p,null,"Aura reward poolstakeFor() can be used to increase _balances[vault], allowing the vault to withdraw from aura without having deposited:\n",a.createElement(t.a,{href:"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/BaseRewardPool.sol#L196-L227"},"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/BaseRewardPool.sol#L196-L227")),"\n",a.createElement(t.p,null,"Withdraw function of Aura reward checks for _balances[msg.sender] and calls withdrawTo on Booser:\n",a.createElement(t.a,{href:"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/BaseRewardPool.sol#L260-L285"},"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/BaseRewardPool.sol#L260-L285")),"\n",a.createElement(t.p,null,"Withdraw function of Booster (called by withdrawTo) burns the pool token, which could have been transferred by the user:\n",a.createElement(t.a,{href:"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/Booster.sol#L483-L509"},"https://github.com/aurafinance/convex-platform/blob/c17d05039f8ed5cda8fdebb72e0a17f0119521b9/contracts/contracts/Booster.sol#L483-L509")),"\n",a.createElement(t.p,null,"The rest of the wihtdraw() function of BLVaultLido will run smoothly without specific care from the attacker, it exits the balancer pool using the LP token received from Aura and repays the wstETH / OHM."),"\n",a.createElement(t.h2,null,"Impact"),"\n",a.createElement(t.p,null,"Users can break the tracking of totalLp in the vault manager, preventing other users to withdraw."),"\n",a.createElement(t.p,null,"The cost of the attack to the user is limited, they mint LP tokens, stake them, and eventually get wstETH back. They lose 50% of the value of the withdraw since they receive only the wstETH and not the OHM (which they had to LP). However, it is sufficient that a user perform this attack with a value of 1 with negligible costs to break accounting."),"\n",a.createElement(t.h2,null,"Recommendation"),"\n",a.createElement(t.p,null,"Add tracking of deposits and withdraw within user vaults so that they can only withdraw what they deposited."),"\n",a.createElement(t.hr),"\n",a.createElement(t.h1,null,"Medium: SetLimit does not take into account burned OHM"),"\n",a.createElement(t.h2,null,"Summary"),"\n",a.createElement(t.p,null,"The function setLimit() may not be able to sufficiently restrict mint ability of manager."),"\n",a.createElement(t.h2,null,"Vulnerability Detail"),"\n",a.createElement(t.p,null,"The setLimit() function reverts when newLimit_ < deployedOhm, mintOhmToVault will revert if deployedOhm + amount_ > ohmLimit + circulatingOhmBurned. If the value of circulatingOhmBurned is high, and the admin can only set the limit above deployedOhm, they could end up in a state where they cannot limit the amount the vault is allowed to burn sufficiently. I.e. the vault is always able to mint at least circulatingOhmBurned new tokens."),"\n",a.createElement(t.p,null,"Note that circulatingOhmBurned is never lowered (even when minting new tokens), so this value could grow arbitrarily high."),"\n",a.createElement(t.h2,null,"Impact"),"\n",a.createElement(t.p,null,"Lack of control of admin on mint ability of manager."),"\n",a.createElement(t.h2,null,"Code Snippet"),"\n",a.createElement(t.p,null,"SetLimit function:\n",a.createElement(t.a,{href:"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultManagerLido.sol#L480-L483"},"https://github.com/sherlock-audit/2023-03-olympus/blob/main/sherlock-olympus/src/policies/BoostedLiquidity/BLVaultManagerLido.sol#L480-L483")),"\n",a.createElement(t.h2,null,"Recommendation"),"\n",a.createElement(t.p,null,"Use similar restrictions as in mintOhmToVault() for setLimit or lower circulatingOhmBurned when minting new OHM."))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,i.ah)(),e.components);return t?a.createElement(t,e,a.createElement(l,e)):l(e)},r=n(4765);function c(e){return a.createElement(r.Z,e,a.createElement(o,e))}r.Z}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-olympus-dao-report-index-mdx-391d47d8048100dcee49.js.map