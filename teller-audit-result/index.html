<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.8.1"/><meta name="description" content="Results of the Teller audit on Sherlock" data-gatsby-head="true"/><meta name="image" content="https://cducrest.github.io/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/a6c62/teller.jpg" data-gatsby-head="true"/><meta property="og:title" content="Teller audit result | cducrest Blog" data-gatsby-head="true"/><meta property="og:url" content="https://cducrest.github.io/auditor-blog/teller-audit-result" data-gatsby-head="true"/><meta property="og:description" content="Results of the Teller audit on Sherlock" data-gatsby-head="true"/><meta property="og:image" content="https://cducrest.github.io/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/a6c62/teller.jpg" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:image:alt" content="Results of the Teller audit on Sherlock" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="Teller audit result | cducrest Blog" data-gatsby-head="true"/><meta name="twitter:url" content="https://cducrest.github.io/auditor-blog/teller-audit-result" data-gatsby-head="true"/><meta name="twitter:description" content="Results of the Teller audit on Sherlock" data-gatsby-head="true"/><meta name="twitter:image" content="https://cducrest.github.io/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/a6c62/teller.jpg" data-gatsby-head="true"/><meta name="twitter:image:alt" content="Results of the Teller audit on Sherlock" data-gatsby-head="true"/><meta name="twitter:creator" content="@cducrest" data-gatsby-head="true"/><meta name="gatsby-theme" content="@lekoarts/gatsby-theme-minimal-blog" data-gatsby-head="true"/><link rel="sitemap" type="application/xml" href="/auditor-blog/sitemap-index.xml"/><link rel="manifest" href="/auditor-blog/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="192x192" href="/auditor-blog/android-chrome-192x192.png"/><link rel="apple-touch-icon" sizes="512x512" href="/auditor-blog/android-chrome-512x512.png"/><link rel="alternate" type="application/rss+xml" title="cducrest Blog" href="/auditor-blog/rss.xml"/><style data-emotion="css-global 1s7ffb4" data-gatsby-head="true">html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-function-variable-color:#6f42c1;--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);}</style><style data-emotion="css-global 1w2pyfm" data-gatsby-head="true">*{box-sizing:border-box;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);margin:0;padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}body{margin:0;}</style><title data-gatsby-head="true">Teller audit result | cducrest Blog</title><link rel="icon" type="image/png" sizes="32x32" href="/auditor-blog/favicon-32x32.png" data-gatsby-head="true"/><link rel="icon" type="image/png" sizes="16x16" href="/auditor-blog/favicon-16x16.png" data-gatsby-head="true"/><link rel="apple-touch-icon" sizes="180x180" href="/auditor-blog/apple-touch-icon.png" data-gatsby-head="true"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global 1s7ffb4">html{--theme-ui-colors-transparent:transparent;--theme-ui-colors-black:#000;--theme-ui-colors-white:#fff;--theme-ui-colors-gray-1:#f7fafc;--theme-ui-colors-gray-2:#edf2f7;--theme-ui-colors-gray-3:#e2e8f0;--theme-ui-colors-gray-4:#cbd5e0;--theme-ui-colors-gray-5:#a0aec0;--theme-ui-colors-gray-6:#718096;--theme-ui-colors-gray-7:#4a5568;--theme-ui-colors-gray-8:#2d3748;--theme-ui-colors-gray-9:#1a202c;--theme-ui-colors-red-1:#fff5f5;--theme-ui-colors-red-2:#fed7d7;--theme-ui-colors-red-3:#feb2b2;--theme-ui-colors-red-4:#fc8181;--theme-ui-colors-red-5:#f56565;--theme-ui-colors-red-6:#e53e3e;--theme-ui-colors-red-7:#c53030;--theme-ui-colors-red-8:#9b2c2c;--theme-ui-colors-red-9:#742a2a;--theme-ui-colors-orange-1:#fffaf0;--theme-ui-colors-orange-2:#feebc8;--theme-ui-colors-orange-3:#fbd38d;--theme-ui-colors-orange-4:#f6ad55;--theme-ui-colors-orange-5:#ed8936;--theme-ui-colors-orange-6:#dd6b20;--theme-ui-colors-orange-7:#c05621;--theme-ui-colors-orange-8:#9c4221;--theme-ui-colors-orange-9:#7b341e;--theme-ui-colors-yellow-1:#fffff0;--theme-ui-colors-yellow-2:#fefcbf;--theme-ui-colors-yellow-3:#faf089;--theme-ui-colors-yellow-4:#f6e05e;--theme-ui-colors-yellow-5:#ecc94b;--theme-ui-colors-yellow-6:#d69e2e;--theme-ui-colors-yellow-7:#b7791f;--theme-ui-colors-yellow-8:#975a16;--theme-ui-colors-yellow-9:#744210;--theme-ui-colors-green-1:#f0fff4;--theme-ui-colors-green-2:#c6f6d5;--theme-ui-colors-green-3:#9ae6b4;--theme-ui-colors-green-4:#68d391;--theme-ui-colors-green-5:#48bb78;--theme-ui-colors-green-6:#38a169;--theme-ui-colors-green-7:#2f855a;--theme-ui-colors-green-8:#276749;--theme-ui-colors-green-9:#22543d;--theme-ui-colors-teal-1:#e6fffa;--theme-ui-colors-teal-2:#b2f5ea;--theme-ui-colors-teal-3:#81e6d9;--theme-ui-colors-teal-4:#4fd1c5;--theme-ui-colors-teal-5:#38b2ac;--theme-ui-colors-teal-6:#319795;--theme-ui-colors-teal-7:#2c7a7b;--theme-ui-colors-teal-8:#285e61;--theme-ui-colors-teal-9:#234e52;--theme-ui-colors-blue-1:#ebf8ff;--theme-ui-colors-blue-2:#bee3f8;--theme-ui-colors-blue-3:#90cdf4;--theme-ui-colors-blue-4:#63b3ed;--theme-ui-colors-blue-5:#4299e1;--theme-ui-colors-blue-6:#3182ce;--theme-ui-colors-blue-7:#2b6cb0;--theme-ui-colors-blue-8:#2c5282;--theme-ui-colors-blue-9:#2a4365;--theme-ui-colors-indigo-1:#ebf4ff;--theme-ui-colors-indigo-2:#c3dafe;--theme-ui-colors-indigo-3:#a3bffa;--theme-ui-colors-indigo-4:#7f9cf5;--theme-ui-colors-indigo-5:#667eea;--theme-ui-colors-indigo-6:#5a67d8;--theme-ui-colors-indigo-7:#4c51bf;--theme-ui-colors-indigo-8:#434190;--theme-ui-colors-indigo-9:#3c366b;--theme-ui-colors-purple-1:#faf5ff;--theme-ui-colors-purple-2:#e9d8fd;--theme-ui-colors-purple-3:#d6bcfa;--theme-ui-colors-purple-4:#b794f4;--theme-ui-colors-purple-5:#9f7aea;--theme-ui-colors-purple-6:#805ad5;--theme-ui-colors-purple-7:#6b46c1;--theme-ui-colors-purple-8:#553c9a;--theme-ui-colors-purple-9:#44337a;--theme-ui-colors-pink-1:#fff5f7;--theme-ui-colors-pink-2:#fed7e2;--theme-ui-colors-pink-3:#fbb6ce;--theme-ui-colors-pink-4:#f687b3;--theme-ui-colors-pink-5:#ed64a6;--theme-ui-colors-pink-6:#d53f8c;--theme-ui-colors-pink-7:#b83280;--theme-ui-colors-pink-8:#97266d;--theme-ui-colors-pink-9:#702459;--theme-ui-colors-grayDark:#2d3748;--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-primaryHover:#2c5282;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-success:#9ae6b4;--theme-ui-colors-info:#63b3ed;--theme-ui-colors-warning:#faf089;--theme-ui-colors-danger:#feb2b2;--theme-ui-colors-light:#f7fafc;--theme-ui-colors-dark:#2d3748;--theme-ui-colors-textMuted:#718096;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-comment-fontStyle:italic;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-prolog-fontStyle:italic;--theme-ui-colors-doctype-color:#999988;--theme-ui-colors-doctype-fontStyle:italic;--theme-ui-colors-cdata-color:#999988;--theme-ui-colors-cdata-fontStyle:italic;--theme-ui-colors-namespace-opacity:0.7;--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-entity-color:#36acaa;--theme-ui-colors-url-color:#36acaa;--theme-ui-colors-symbol-color:#36acaa;--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-boolean-color:#36acaa;--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-property-color:#36acaa;--theme-ui-colors-regex-color:#36acaa;--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-atrule-color:#00a4db;--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-function-variable-color:#6f42c1;--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:#cbd5e0;--theme-ui-colors-primary:#b794f4;--theme-ui-colors-secondary:#8a9ab0;--theme-ui-colors-toggleIcon:#cbd5e0;--theme-ui-colors-background:#1A202C;--theme-ui-colors-heading:#fff;--theme-ui-colors-divide:#2d3748;--theme-ui-colors-muted:#2d3748;--theme-ui-colors-highlightLineBg:rgba(255, 255, 255, 0.1);--theme-ui-colors-plain-color:#9CDCFE;--theme-ui-colors-plain-backgroundColor:#1E1E1E;--theme-ui-colors-prolog-color:rgb(0, 0, 128);--theme-ui-colors-comment-color:rgb(106, 153, 85);--theme-ui-colors-builtin-color:rgb(86, 156, 214);--theme-ui-colors-changed-color:rgb(86, 156, 214);--theme-ui-colors-keyword-color:rgb(86, 156, 214);--theme-ui-colors-interpolation-punctuation-color:rgb(86, 156, 214);--theme-ui-colors-number-color:rgb(181, 206, 168);--theme-ui-colors-inserted-color:rgb(181, 206, 168);--theme-ui-colors-constant-color:rgb(100, 102, 149);--theme-ui-colors-attr-name-color:rgb(156, 220, 254);--theme-ui-colors-variable-color:rgb(156, 220, 254);--theme-ui-colors-deleted-color:rgb(206, 145, 120);--theme-ui-colors-string-color:rgb(206, 145, 120);--theme-ui-colors-attr-value-color:rgb(206, 145, 120);--theme-ui-colors-template-punctuation-color:rgb(206, 145, 120);--theme-ui-colors-selector-color:rgb(215, 186, 125);--theme-ui-colors-tag-color:rgb(86, 156, 214);--theme-ui-colors-punctuation-color:#808080;--theme-ui-colors-operator-color:rgb(212, 212, 212);--theme-ui-colors-function-color:rgb(220, 220, 170);--theme-ui-colors-class-name-color:rgb(78, 201, 176);--theme-ui-colors-char-color:rgb(209, 105, 105);}</style><style data-emotion="css-global 1w2pyfm">*{box-sizing:border-box;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);margin:0;padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}body{margin:0;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global h7esfd">*{box-sizing:inherit;}html{-webkit-text-size-adjust:100%;}img{border-style:none;}pre{font-family:monospace;font-size:1em;}[hidden]{display:none;}::selection{background-color:var(--theme-ui-colors-text);color:var(--theme-ui-colors-background);}a{-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;color:text;}</style><style data-emotion="css 1gq7j3t">.css-1gq7j3t{border:0;clip:react(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;overflow:hidden;position:absolute;}.css-1gq7j3t:focus{padding:1rem;position:fixed;top:15px;left:15px;background-color:var(--theme-ui-colors-heading);color:var(--theme-ui-colors-background);z-index:1;width:auto;height:auto;clip:auto;-webkit-text-decoration:none;text-decoration:none;}</style><a href="#skip-nav" data-skip-link="true" class="css-1gq7j3t">Skip to content</a><style data-emotion="css 10f80pj">.css-10f80pj{box-sizing:border-box;margin:0;min-width:0;width:100%;max-width:container;margin-left:auto;margin-right:auto;padding:1rem;max-width:1024px;}@media screen and (min-width: 640px){.css-10f80pj{padding:2rem;}}</style><div class="css-10f80pj"><style data-emotion="css egutgn">.css-egutgn{margin-bottom:4rem;}@media screen and (min-width: 640px){.css-egutgn{margin-bottom:8rem;}}</style><header class="css-egutgn"><style data-emotion="css 1xwyizx">.css-1xwyizx{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><style data-emotion="css 1pbimyf">.css-1pbimyf{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><div class="css-1pbimyf"><style data-emotion="css uxjqfw">.css-uxjqfw{color:var(--theme-ui-colors-heading);-webkit-text-decoration:none;text-decoration:none;}</style><a aria-label="cducrest Blog - Back to home" class="css-uxjqfw" href="/auditor-blog"><style data-emotion="css 19i8ga6">.css-19i8ga6{margin-top:0;margin-bottom:0;font-weight:600;font-size:1.5rem;}@media screen and (min-width: 640px){.css-19i8ga6{font-size:1.875rem;}}</style><div class="css-19i8ga6">cducrest Blog</div></a></div><style data-emotion="css fp1v3n">.css-fp1v3n{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:var(--theme-ui-colors-divide);padding-bottom:1rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-top:1rem;color:var(--theme-ui-colors-secondary);-webkit-box-flex-flow:wrap;-webkit-flex-flow:wrap;-ms-flex-flow:wrap;flex-flow:wrap;}.css-fp1v3n a{color:var(--theme-ui-colors-secondary);}.css-fp1v3n a:hover{color:var(--theme-ui-colors-heading);}</style><div class="css-fp1v3n"><style data-emotion="css 1lx5s1f">.css-1lx5s1f{font-size:1rem;}.css-1lx5s1f a:not(:last-of-type){margin-right:1rem;}@media screen and (min-width: 640px){.css-1lx5s1f{font-size:18px;}}.css-1lx5s1f .active{color:var(--theme-ui-colors-heading);}</style><nav class="css-1lx5s1f"><style data-emotion="css bpdkdn">.css-bpdkdn{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-bpdkdn:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="css-bpdkdn" href="/auditor-blog/blog">Blog</a><a class="css-bpdkdn" href="/auditor-blog/about">About</a><a class="css-bpdkdn" href="/auditor-blog/knowledge-references">References</a></nav><style data-emotion="css 45ghvz">.css-45ghvz{font-size:1rem;}.css-45ghvz a:not(:first-of-type){margin-left:1rem;}@media screen and (min-width: 640px){.css-45ghvz{font-size:18px;}}</style><div class="css-45ghvz"><style data-emotion="css aizfxq">.css-aizfxq{box-sizing:border-box;margin:0;min-width:0;color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-aizfxq:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="https://twitter.com/Oizo____" class="css-aizfxq">Twitter</a><a href="https://github.com/cducrest" class="css-aizfxq">Github</a></div></div></header><style data-emotion="css 1w9aswf">.css-1w9aswf .prism-code{font-size:1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-1w9aswf .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-1w9aswf .prism-code{font-size:1.25rem;}}.css-1w9aswf .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-1w9aswf .gatsby-highlight[data-language='none'] .code-content,.css-1w9aswf .gatsby-highlight[data-language=''] .code-content{padding-top:1rem;}.css-1w9aswf .code-content{padding:2rem 1rem 1rem 1rem;color:var(--theme-ui-colors-plain-color);background-color:var(--theme-ui-colors-plain-backgroundColor);}.css-1w9aswf .token{display:inline-block;}.css-1w9aswf p>code,.css-1w9aswf li>code{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-heading);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:4px;font-size:0.95em;}.css-1w9aswf .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;border-radius:4px;overflow:hidden;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-1w9aswf .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-1w9aswf .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-1w9aswf .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-1w9aswf .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-1w9aswf .gatsby-highlight pre code{float:left;min-width:100%;}.css-1w9aswf .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 4px 4px;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.035rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;}.css-1w9aswf .gatsby-highlight pre[class~="language-golang"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-go"]:before{content:"go";background:#79d4fd;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-javascript"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-1w9aswf .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black);}.css-1w9aswf .gatsby-highlight pre[class~="language-py"]:before,.css-1w9aswf .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-1w9aswf .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-1w9aswf .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-1w9aswf .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-1w9aswf .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-1w9aswf .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-1w9aswf .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-1w9aswf .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-1w9aswf .gatsby-highlight pre[class~='language-json']:before,.css-1w9aswf .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-1w9aswf .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-1w9aswf .gatsby-highlight>code[class*="language-"],.css-1w9aswf .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-1w9aswf .gatsby-highlight pre::-webkit-scrollbar-track{background:var(--theme-ui-colors-muted);}.css-1w9aswf .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-1w9aswf .code-title{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-text);font-size:1rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";}.css-1w9aswf .token-line{padding-right:1rem;}.css-1w9aswf .highlight-line{border-left:4px solid rgb(2, 155, 206);}.css-1w9aswf .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-1w9aswf .footnotes{border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:0.5rem;margin-top:4rem;overflow:auto;}.css-1w9aswf .footnotes .sr-only{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><style data-emotion="css 1wlcpc3">.css-1wlcpc3{box-sizing:border-box;margin:0;min-width:0;}.css-1wlcpc3 .prism-code{font-size:1rem;webkit-overflow-scrolling:touch;background-color:var(--theme-ui-colors-transparent);min-width:100%;margin-bottom:0;margin-top:0;overflow:auto;}@media screen and (min-width: 640px){.css-1wlcpc3 .prism-code{font-size:1rem;}}@media screen and (min-width: 768px){.css-1wlcpc3 .prism-code{font-size:1.25rem;}}.css-1wlcpc3 .prism-code[data-linenumber="false"] .token-line{padding-left:1rem;}.css-1wlcpc3 .gatsby-highlight[data-language='none'] .code-content,.css-1wlcpc3 .gatsby-highlight[data-language=''] .code-content{padding-top:1rem;}.css-1wlcpc3 .code-content{padding:2rem 1rem 1rem 1rem;color:var(--theme-ui-colors-plain-color);background-color:var(--theme-ui-colors-plain-backgroundColor);}.css-1wlcpc3 .token{display:inline-block;}.css-1wlcpc3 p>code,.css-1wlcpc3 li>code{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-heading);padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-radius:4px;font-size:0.95em;}.css-1wlcpc3 .gatsby-highlight{font-size:1rem;position:relative;webkit-overflow-scrolling:touch;border-radius:4px;overflow:hidden;margin-left:0;margin-right:0;}@media screen and (min-width: 640px){.css-1wlcpc3 .gatsby-highlight{font-size:1rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 768px){.css-1wlcpc3 .gatsby-highlight{font-size:1.25rem;margin-left:0;margin-right:0;}}@media screen and (min-width: 1024px){.css-1wlcpc3 .gatsby-highlight{margin-left:-1rem;margin-right:-1rem;}}.css-1wlcpc3 .gatsby-highlight .token-line{margin-left:-1rem;margin-right:-1rem;min-width:100%;}.css-1wlcpc3 .gatsby-highlight pre code{float:left;min-width:100%;}.css-1wlcpc3 .gatsby-highlight pre[class*="language-"]:before{background-color:var(--theme-ui-colors-white);border-radius:0 0 4px 4px;color:var(--theme-ui-colors-black);font-size:12px;letter-spacing:0.035rem;padding:0.1rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-weight:600;}.css-1wlcpc3 .gatsby-highlight pre[class~="language-golang"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-go"]:before{content:"go";background:#79d4fd;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-javascript"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-js"]:before{content:"js";background:#f7df1e;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-jsx"]:before{content:"jsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-ts"]:before{content:"ts";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-tsx"]:before{content:"tsx";background:#61dafb;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-html"]:before{content:"html";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-xml"]:before{content:"xml";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-svg"]:before{content:"svg";background:#005a9c;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-graphql"]:before{content:"GraphQL";background:#E10098;}.css-1wlcpc3 .gatsby-highlight pre[class~="language-css"]:before{content:"css";background:#ff9800;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-mdx"]:before{content:"mdx";background:#f9ac00;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-php"]:before{content:"php";background:#777bb3;color:var(--theme-ui-colors-black);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-py"]:before,.css-1wlcpc3 .gatsby-highlight pre[class~="language-python"]:before{content:"py";background:#306998;color:var(--theme-ui-colors-white);}.css-1wlcpc3 .gatsby-highlight pre[class~="language-text"]:before{content:"text";}.css-1wlcpc3 .gatsby-highlight pre[class~='language-shell']:before{content:'shell';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-sh']:before{content:'sh';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-bash']:before{content:'bash';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-yaml']:before{content:'yaml';background:#ffa8df;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-yml']:before{content:'yml';background:#ffa8df;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-markdown']:before{content:'md';}.css-1wlcpc3 .gatsby-highlight pre[class~='language-json']:before,.css-1wlcpc3 .gatsby-highlight pre[class~='language-json5']:before{content:'json';background:linen;}.css-1wlcpc3 .gatsby-highlight pre[class~='language-diff']:before{content:'diff';background:#e6ffed;}.css-1wlcpc3 .gatsby-highlight>code[class*="language-"],.css-1wlcpc3 .gatsby-highlight>pre[class=*="language-"]{word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar{width:0.5rem;height:0.5rem;}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar-thumb{background-color:var(--theme-ui-colors-primary);}.css-1wlcpc3 .gatsby-highlight pre::-webkit-scrollbar-track{background:var(--theme-ui-colors-muted);}.css-1wlcpc3 .line-number-style{display:inline-block;width:3em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.3;text-align:center;position:relative;}.css-1wlcpc3 .code-title{background-color:var(--theme-ui-colors-muted);color:var(--theme-ui-colors-text);font-size:1rem;padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";}.css-1wlcpc3 .token-line{padding-right:1rem;}.css-1wlcpc3 .highlight-line{border-left:4px solid rgb(2, 155, 206);}.css-1wlcpc3 .highlight-line .line-number-style{width:calc(3em - 4px);opacity:0.5;left:-2px;}.css-1wlcpc3 .footnotes{border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:0.5rem;margin-top:4rem;overflow:auto;}.css-1wlcpc3 .footnotes .sr-only{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><main id="skip-nav" class=" css-1wlcpc3"><style data-emotion="css w1q1hj">.css-w1q1hj{box-sizing:border-box;margin:0;min-width:0;font-family:inherit;font-weight:700;line-height:1.25;font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-w1q1hj{font-size:2.25rem;}}@media screen and (min-width: 768px){.css-w1q1hj{font-size:2.25rem;}}@media screen and (min-width: 1024px){.css-w1q1hj{font-size:3rem;}}</style><h1 class="css-w1q1hj">Teller audit result</h1><style data-emotion="css 15ce8we">.css-15ce8we{color:var(--theme-ui-colors-secondary);margin-top:1rem;font-size:1rem;}.css-15ce8we a{color:var(--theme-ui-colors-secondary);}@media screen and (min-width: 640px){.css-15ce8we{font-size:1rem;}}@media screen and (min-width: 768px){.css-15ce8we{font-size:1.25rem;}}</style><p class="css-15ce8we"><time>26.06.2023</time> — <a class="css-bpdkdn" href="/auditor-blog/tags/audit-result">Audit result</a>, <a class="css-bpdkdn" href="/auditor-blog/tags/sherlock">Sherlock</a> — <span>21<!-- --> min read</span></p><style data-emotion="css 1mae7sn">.css-1mae7sn{margin-top:4rem;margin-bottom:4rem;}.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;border-radius:4px;box-shadow:rgba(0, 0, 0, 0.1) 0px 16px 16px 0px,rgba(0, 0, 0, 0.1) 0px 8px 8px 0px,rgba(0, 0, 0, 0.1) 0px 4px 4px 0px;}@media screen and (min-width: 640px){.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:2rem;margin-bottom:2rem;}}@media screen and (min-width: 768px){.css-1mae7sn .gatsby-resp-image-wrapper{margin-top:4rem;margin-bottom:4rem;}}.css-1mae7sn .gatsby-resp-image-wrapper .gatsby-resp-image-image{border-radius:4px;}.css-1mae7sn figure{margin:0;}.css-1mae7sn figure img{border-radius:4px;box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);max-width:100%;}</style><section class="css-1mae7sn"><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEEAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB9/i50a0LsCg//8QAGxAAAQQDAAAAAAAAAAAAAAAAAgABERIDECD/2gAIAQEAAQUCQkxaKa47Tx//xAAWEQEBAQAAAAAAAAAAAAAAAAABICH/2gAIAQMBAT8BXY//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAZEAACAwEAAAAAAAAAAAAAAAAAIRAgQYH/2gAIAQEABj8CFCN7X//EAB0QAAIBBAMAAAAAAAAAAAAAAAERIQAQMXEgQfD/2gAIAQEAAT8hpq7RVpnfaoQlHB9zvj//2gAMAwEAAgADAAAAENzHAP/EABURAQEAAAAAAAAAAAAAAAAAAAEg/9oACAEDAQE/EHABH//EABYRAQEBAAAAAAAAAAAAAAAAAAEgIf/aAAgBAgEBPxAMj//EAB4QAQABAwUBAAAAAAAAAAAAAAERACFxECAxQZGh/9oACAEBAAE/EKKdxvJoWJFkArK/TU8EEyQ8Dl9bf//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="teller"
        title=""
        src="/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/27ec1/teller.jpg"
        srcset="/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/46946/teller.jpg 240w,
/auditor-blog/static/eaa8c69899d7645cda058ed5da5485c2/27ec1/teller.jpg 400w"
        sizes="(max-width: 400px) 100vw, 400px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></span>
<style data-emotion="css vehe2z">.css-vehe2z{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width: 640px){.css-vehe2z{font-size:1rem;}}@media screen and (min-width: 768px){.css-vehe2z{font-size:1.25rem;}}</style><style data-emotion="css z0logh">.css-z0logh{font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;font-size:1rem;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;word-break:break-word;}@media screen and (min-width: 640px){.css-z0logh{font-size:1rem;}}@media screen and (min-width: 768px){.css-z0logh{font-size:1.25rem;}}@media screen and (min-width: 640px){.css-z0logh{font-size:1rem;}}@media screen and (min-width: 768px){.css-z0logh{font-size:1.25rem;}}</style><p class="css-z0logh">Teller is a borrowing / lending protocol allowing lender to enter markets and accept borrower bids for loans. The loans can be collateralized with ERC20 and ERC721 tokens.
Interests are accrued in the principal of the loan and repayment schedule of the loan is defined by the market parameters while value and duration of the
loans are defined by the borrowers.</p>
<p class="css-z0logh">The code was reviewed as part of the <style data-emotion="css 1d2wwf6">.css-1d2wwf6{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-1d2wwf6:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><style data-emotion="css 1diwg7s">.css-1diwg7s{color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary);-webkit-text-decoration:none;text-decoration:none;}.css-1diwg7s:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-1diwg7s:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><a href="https://app.sherlock.xyz/audits/contests/62" class="css-1diwg7s">Sherlock contest</a>.
I ranked 2nd out of 230 participants in this audit. I found 4 high and 8 medium vulnerabilities.
I present my findings here.</p>
<style data-emotion="css tcuklq">.css-tcuklq{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-tcuklq{font-size:2.25rem;}}@media screen and (min-width: 768px){.css-tcuklq{font-size:2.25rem;}}@media screen and (min-width: 1024px){.css-tcuklq{font-size:3rem;}}</style><style data-emotion="css cha28j">.css-cha28j{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:2rem;color:var(--theme-ui-colors-heading);font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-cha28j{font-size:2.25rem;}}@media screen and (min-width: 768px){.css-cha28j{font-size:2.25rem;}}@media screen and (min-width: 1024px){.css-cha28j{font-size:3rem;}}@media screen and (min-width: 640px){.css-cha28j{font-size:2.25rem;}}@media screen and (min-width: 768px){.css-cha28j{font-size:2.25rem;}}@media screen and (min-width: 1024px){.css-cha28j{font-size:3rem;}}</style><h1 class="css-cha28j">High: Missing access control in setCollateralEscrowBeacon</h1>
<style data-emotion="css 90ntna">.css-90ntna{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-90ntna{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-90ntna{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-90ntna{font-size:2.25rem;}}</style><style data-emotion="css 1h962gv">.css-1h962gv{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:2rem;color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-1h962gv{font-size:2.25rem;}}@media screen and (min-width: 640px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 768px){.css-1h962gv{font-size:1.875rem;}}@media screen and (min-width: 1024px){.css-1h962gv{font-size:2.25rem;}}</style><h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The function to set the reference implementation of the escrow inside of <code class="css-zezy6m">CollateralManager</code> has no access control. It can be used by an attack to set its own implementation as a reference.</p>
<p class="css-z0logh">The attacker could use an escrow where they are allowed to withdraw the collateral. They can use the <code class="css-zezy6m">LenderCommitmentForwarder</code> to automatically make a bid with collateral and accept it. They can then withdraw their collateral and never repay the loan. They can repeat the operation until <code class="css-zezy6m">LenderCommitmentForwarder</code> is drained out of funds.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh"><code class="css-zezy6m">TellerV2</code> and <code class="css-zezy6m">CollateralManager</code> expose re-initializer functions. I believe the goal of these functions is to set values that were not present in the past versions of the contracts after an upgrade:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><style data-emotion="css ce1lkk">.css-ce1lkk{background-color:var(--theme-ui-colors-background);border:none;color:var(--theme-ui-colors-text);cursor:pointer;font-size:14px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";letter-spacing:0.025rem;-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;position:absolute;right:0;z-index:1;border-radius:0 0 0 0.25rem;padding:0.25rem 0.6rem;}@media screen and (min-width: 640px){.css-ce1lkk{font-size:14px;}}@media screen and (min-width: 768px){.css-ce1lkk{font-size:16px;}}.css-ce1lkk[disabled]{cursor:not-allowed;}.css-ce1lkk:not([disabled]):hover{background-color:var(--theme-ui-colors-primary);color:var(--theme-ui-colors-white);}</style><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<style data-emotion="css 15vf505">.css-15vf505{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px;}</style><span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setLenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> _lenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">external</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">reinitializer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">        onlyOwner</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">_setLenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_lenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setCollateralEscrowBeacon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> _collateralEscrowBeacon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">external</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">reinitializer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        collateralEscrowBeacon </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> _collateralEscrowBeacon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">As we can see, <code class="css-zezy6m">setLenderManager</code> uses the <code class="css-zezy6m">onlyOwner</code> modifier and <code class="css-zezy6m">setCollateralEscrowBeacon</code> has no protection.</p>
<p class="css-z0logh"><code class="css-zezy6m">setCollateralEscrowBeacon</code> can be called by an attacker during upgrades of the protocol before the protocol team has the time to call it (or as a front-run tx).</p>
<p class="css-z0logh">If the re-initializer function has not been called at all by the protocol team, the problem can be even longer-lived. As the value of <code class="css-zezy6m">collateralEscrowBeacon</code> is already set in <code class="css-zezy6m">initialize()</code>, it could be that the re-initializer has never been called for some instances of the contract and is free to be abused:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> _collateralEscrowBeacon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> _tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">external</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        initializer</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        collateralEscrowBeacon </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> _collateralEscrowBeacon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        tellerV2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ITellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">__Ownable_init_unchained</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Usually front-running initializer is not an important problem as the protocol team can simply re-deploy (or in this case re-upgrade) to fix / avoid the problem.</p>
<p class="css-z0logh">However in this case, the upgrade impacts a live ecosystem with value at stake.</p>
<p class="css-z0logh">As explained in the summary, the attacker can use a beacon with a reference implementation that allows them to withdraw the collateral at all times.</p>
<p class="css-z0logh">If a lender accepts a loan with collateral at that time, the attacker will be allowed to withdraw the collateral of the user, resulting in a loss of funds for both borrower and lender (borrower lost collateral and won&#x27;t repay loan to lender).</p>
<p class="css-z0logh">The loan acceptance process is automated in <code class="css-zezy6m">LenderCommitmentForwarder</code> and the attacker can simply open a loan through it, withdraw the collateral, and repeat the operation until no funds are left in the <code class="css-zezy6m">LenderCommitmentForwarder</code>.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<p class="css-z0logh">LenderCommitmentForwarder automated loan opening feature:</p>
<p class="css-z0logh"><a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L300-L400" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L300-L400</a></p>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Add access control to <code class="css-zezy6m">setCollateralEscrowBeacon</code></p>
<style data-emotion="css igtsiw">.css-igtsiw{background-color:var(--theme-ui-colors-muted);border:0;height:1px;margin:1rem;margin-left:0;margin-right:0;}</style><style data-emotion="css 1ve732v">.css-1ve732v{background-color:var(--theme-ui-colors-muted);border:0;height:1px;margin:1rem;margin-left:0;margin-right:0;background-color:var(--theme-ui-colors-muted);border:0;height:1px;margin:1rem;margin-left:0;margin-right:0;}</style><hr class="css-1ve732v"/>
<h1 class="css-cha28j">High: _repayLoan will fail if lender is blacklisted</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The internal function that repays a loan <code class="css-zezy6m">_repayLoan</code> attempts to transfer the loan token back to the lender. If the loan token implements a blacklist like the common USDC token, the transfer may be impossible and the repayment will fail.</p>
<p class="css-z0logh">This internal <code class="css-zezy6m">_repayLoan</code> function is called during any partial / full repayment and during liquidation.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The function to repay the loan to the lender directly transfers the token to the lender:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_repayLoan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">internal</span><span class="token plain"> virtual </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loanDetails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lendingToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">safeTransferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">_msgSenderForMarket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">marketplaceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">            lender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">            paymentAmount</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></code></pre></div>
<p class="css-z0logh">This function is called by any function that attemps to repay a loan (including liquidate):
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L593" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L593</a>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L615" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L615</a>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L649" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L649</a>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L690" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L690</a></p>
<p class="css-z0logh">Any of these functions will fail if loan lender is blacklisted by the token.</p>
<p class="css-z0logh">During repayment the loan lender is computed by:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getLoanLender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">view</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> lender_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        lender_ </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lender_ </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> lenderManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ownerOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">If the lender controls a blacklisted address, they can use the lenderManager to selectively transfer the loan to / from the blacklisted whenever they want.</p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Any lender can prevent repayment of a loan and its liquidation. In particular, a lender can wait until a loan is almost completely repaid, transfer the loan to a blacklisted address (even one they do not control) to prevent the loan to be fully repaid / liquidated. The loan will default and borrower will not be able to withdraw their collateral.</p>
<p class="css-z0logh">This result in a guaranteed griefing attack on the collateral of a user.</p>
<p class="css-z0logh">If the lender controls a blacklisted address, they can additionally withdraw the collateral of the user.</p>
<p class="css-z0logh">I believe the impact is high since the griefing attack is always possible whenever lent token uses a blacklist, and results in a guaranteed loss of collateral.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<p class="css-z0logh">The function to withdraw collateral only works when loan is paid or transfer to lender when loan is defaulted:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">external</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        BidState bidState </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getBidState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bidState </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> BidState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PAID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">_withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLoanBorrower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isLoanDefaulted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">_withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLoanLender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">emit</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">CollateralClaimed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">revert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;collateral cannot be withdrawn&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Use a push/pull pattern for transferring tokens. Allow repayment of loan and withdraw the tokens of the user into <code class="css-zezy6m">TellerV2</code> (or an escrow) and allow lender to withdraw the repayment from <code class="css-zezy6m">TellerV2</code> (or the escrow). This way, the repayment will fail only if <code class="css-zezy6m">TellerV2</code> is blacklisted.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">High: Anyone can commit collateral for someone else</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">There is no access control on <code class="css-zezy6m">CollateralManager.commitCollateral()</code>. It takes as input the bid ID and the collateral info and commits the borrower of bid ID to the input collateral.</p>
<p class="css-z0logh">Anyone can call this function to commit any amount of any collateral for any bid ID.</p>
<p class="css-z0logh">When the loan is accepted, the committed to collateral will be taken from the user and used as collateral in an escrow.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">No access control on <code class="css-zezy6m">commitCollateral()</code>:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitCollateral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        Collateral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">calldata</span><span class="token plain"> _collateralInfo</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> validation_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> borrower </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> tellerV2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLoanBorrower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validation_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">checkBalances</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">borrower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _collateralInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">validation_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain"> _collateralInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">                Collateral </span><span class="token keyword" style="color:rgb(127, 219, 202)">memory</span><span class="token plain"> info </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> _collateralInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">_commitCollateral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">There is no access control on any of the called functions down the call chain:</p>
<p class="css-z0logh">No access control on <code class="css-zezy6m">checkBalances()</code> called by <code class="css-zezy6m">commitCollateral()</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L168-L173" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L168-L173</a></p>
<p class="css-z0logh">No access control on <code class="css-zezy6m">_checkBalances()</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L450-L470" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L450-L470</a></p>
<p class="css-z0logh">No access control on <code class="css-zezy6m">_checkBalance()</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L478-L504" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L478-L504</a></p>
<p class="css-z0logh">No access control on <code class="css-zezy6m">_commitCollateral()</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L426-L442" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L426-L442</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">It is necessary that the borrower of the attacked <code class="css-zezy6m">bidId</code> called approve for the committed to tokens for them to be used as collateral when the lender approves the bid.</p>
<p class="css-z0logh">As a result, an attacker can prevent the bid to ever be successfully accepted by committing the bid to a collateral (or a value) that is not approved by the borrower.</p>
<p class="css-z0logh">It is a common pattern that user approves contracts they trust with the max value (<code class="css-zezy6m">type(uint256).max</code>) even though they will only spend parts of their token. A user holding 100 USDC that wants to commit 50 USDC for a bid can be attacked (by evil lender or anyone else) to commit the full 100 USDC and have all their tokens held as collateral when the bid is accepted.</p>
<p class="css-z0logh">Even when user do not use <code class="css-zezy6m">type(uint256).max</code> to approve the contract, if they approved 100 USDC but intend to commit 50 USDC for a certain bid and 50 USDC for another bid, they are vulnerable to the attack.</p>
<p class="css-z0logh">The result is a possible DOS attack on any loan, and a risk of funds for the borrowers.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<p class="css-z0logh">The function that withdraw collateral from user and puts it in escrow, called when loan is accepted:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L179-L199" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L179-L199</a></p>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Only allow bid borrower or <code class="css-zezy6m">TellerV2</code> to call <code class="css-zezy6m">commitCollateral()</code>.
Please not that there are two <code class="css-zezy6m">commitCollateral()</code> functions impacted, one for committing an array of collateral and one for committing a single collateral.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">High: Borrower can front-run lender&#x27;s acceptBid to lower/remove its collateral</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The function <code class="css-zezy6m">TellerV2.submitBid()</code> to submit a bid with collateral does not withdraw a borrower&#x27;s collateral. It only commits to the values via <code class="css-zezy6m">collateralManager.commitCollateral()</code>.</p>
<p class="css-z0logh">When the lender calls <code class="css-zezy6m">lenderAcceptBid</code>, the borrower can front-run the transaction and call <code class="css-zezy6m">collateralManager.commitCollateral()</code> to commit to the previously committed to collateral with an amount of 0.</p>
<p class="css-z0logh">The lender will accept the bid but the escrow will be deployed with 0 collateral amount.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The function <code class="css-zezy6m">submitBid()</code> with collateral calls <code class="css-zezy6m">collateralManager.commitCollateral()</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L323-L326" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L323-L326</a></p>
<p class="css-z0logh"><code class="css-zezy6m">commitCollateral()</code> checks the user balances (i.e. the user owns the amount of committed token) and writes to storage the commitment, it does not withdraw the tokens:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L117-L130" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L117-L130</a></p>
<p class="css-z0logh"><a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L426-L442" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L426-L442</a></p>
<p class="css-z0logh"><code class="css-zezy6m">lenderAcceptBid()</code> calls <code class="css-zezy6m">collateralManager.deployAndDeposit()</code> which will deploy an escrow and deposit whatever is currently in the storage of <code class="css-zezy6m">collateralManager</code>. There is no parameter passed by lender as to what collateral it expects:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L510" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L510</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Loaner expecting to accept a loan with collateral will accept a loan without any collateral. The borrower is free to never repay the loan. Borrower gains funds and lender loses funds.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Let lender specify what collateral it expects in <code class="css-zezy6m">lenderAcceptBid()</code>. Or prevent anyone but <code class="css-zezy6m">TellerV2</code> to call <code class="css-zezy6m">commitCollateral()</code> (you may not want that for reason outside the scope of this audit). Or prevent <code class="css-zezy6m">commitCollateral()</code> to lower the committed to collateral values.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: Unsafe use of AddressSet in LenderCommitmentForwarder allows unauthorized borrowers</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The contract <code class="css-zezy6m">LenderCommitmentForwarder</code> uses <code class="css-zezy6m">EnumerableSetUpgradeable.AddressSet</code> for the set of addresses allowed to borrow from a lender for a certain commitment.</p>
<p class="css-z0logh">However, it unsafely uses the <code class="css-zezy6m">delete</code> opcode on it, which does not clean the storage of mappings. This results in removed (previously authorized) borrowers to still be able to borrow from the lender.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The library <code class="css-zezy6m">EnumerableSetUpgradeable</code> states:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">WARNING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> Trying to </span><span class="token keyword" style="color:rgb(127, 219, 202)">delete</span><span class="token plain"> such a structure </span><span class="token keyword" style="color:rgb(127, 219, 202)">from</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">storage</span><span class="token plain"> will likely result in data corruption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rendering the structure</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> unusable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> See https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">ethereum</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token keyword" style="color:rgb(127, 219, 202)">solidity</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">pull</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token number" style="color:rgb(247, 140, 108)">11843</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ethereum</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token keyword" style="color:rgb(127, 219, 202)">solidity</span><span class="token plain">#</span><span class="token number" style="color:rgb(247, 140, 108)">11843</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> more info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> In order to clean an EnumerableSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> you can either remove all elements one by one or create a fresh instance </span><span class="token keyword" style="color:rgb(127, 219, 202)">using</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">an</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> array of EnumerableSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token operator" style="color:rgb(127, 219, 202)">==</span></div></code></pre></div>
<p class="css-z0logh">The contract can be found <a href="https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/blob/master/contracts/utils/structs/EnumerableSetUpgradeable.sol" class="css-1diwg7s">here</a></p>
<p class="css-z0logh">The <code class="css-zezy6m">AddressSet</code> struct uses an inner <code class="css-zezy6m">Set</code> struct:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">AddressSet</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        Set _inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Storage of set values</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> _values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Position of the value in the `values` array, plus 1 because index 0</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// means a value is not in the set.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">mapping</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> _indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">This means that <code class="css-zezy6m">delete addrsSet</code> will only clear the <code class="css-zezy6m">_values</code> array and not the <code class="css-zezy6m">_indexes</code>. The function <code class="css-zezy6m">addrsSet.contains(value)</code> will still return true for previously contained elements after the addrsSet was deleted.</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">contains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">AddressSet </span><span class="token keyword" style="color:rgb(127, 219, 202)">storage</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">internal</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">view</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_contains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_contains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Set </span><span class="token keyword" style="color:rgb(127, 219, 202)">storage</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">view</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">The delete opcode is used by <code class="css-zezy6m">LenderCommitmentForwarder</code> to update the commitment borrowers:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">updateCommitmentBorrowers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">calldata</span><span class="token plain"> _borrowerAddressList</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitmentLender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">delete</span><span class="token plain"> commitmentBorrowersList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">_commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">_addBorrowersToCommitmentAllowlist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _borrowerAddressList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">It is also used in <code class="css-zezy6m">deleteCommitment</code> but that is probably safe:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L267-L274" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L267-L274</a></p>
<p class="css-z0logh">The <code class="css-zezy6m">addressSet.contains(borrower)</code> is used to determine if a borrower is allowed to open a loan from the commitment:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L328-L332" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/LenderCommitmentForwarder.sol#L328-L332</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Borrowers that were once allowed to accept a commitment but later removed are still allowed to accept the commitment.</p>
<p class="css-z0logh">I understand the main reason for this restricted list is to allow for a limited set of addresses to automatically borrow from a lender without collateral. If unauthorized addresses borrow from the lender, they are free not to repay the loan. This results in a loss of funds for the lender.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<p class="css-z0logh">Testing:</p>
<p class="css-z0logh">Add the following (failing) test in <code class="css-zezy6m">LenderCommitmentForwarder_Combined_Test.sol</code>:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">test_acceptCommitmentWithBorrowersArray_change</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> commitmentId </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">        Commitment </span><span class="token keyword" style="color:rgb(127, 219, 202)">storage</span><span class="token plain"> commitment </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_createCommitment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">            CommitmentCollateralType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ERC20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">            maxAmount</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">memory</span><span class="token plain"> newBorrowersArray </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        newBorrowersArray</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">marketOwner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">        lender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">_updateCommitmentBorrowers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> borrowersArray</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">        lender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">_updateCommitmentBorrowers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> newBorrowersArray</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> acceptCommitAsMarketOwnerFails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">        try</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain">            borrower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">_acceptCommitment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">                commitmentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain">                </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//principal</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">                maxAmount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//collateralAmount</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">                </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//collateralTokenId</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">                </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">collateralToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">25</span><span class="token plain">                minInterestRate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">26</span><span class="token plain">                maxLoanDuration</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">27</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">28</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> catch </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">29</span><span class="token plain">            acceptCommitAsMarketOwnerFails </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">30</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">31</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">32</span><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">assertEq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">33</span><span class="token plain">            acceptCommitAsMarketOwnerFails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">34</span><span class="token plain">            </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">35</span><span class="token plain">            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;Should fail when accepting as invalid borrower&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">36</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">37</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Follow OZ&#x27;s recommendation to remove elements one by one or use an array of addrsset instead (i.e. committers provide a completely new set of allowed borrowers and you add that set to the list of stored sets and you check only the most recent set in <code class="css-zezy6m">acceptCommitment()</code>).</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: Loans are liquidateable even when honest if bidDefaultDuration &lt; paymentCycle</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The calculation to determine if a loan is liquidateable does not take into account the payment cycle duration. Under certain circumstances where the payment cycle is shorter than the bid default duration, an honest borrower may repay its loan correctly every cycle but end up being defaulted and liquidated by the lender.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The function to determined if a loan is defaulted checks if the last payment was done more than <code class="css-zezy6m">bidDefaultDuration[_bidId]</code> seconds ago:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">isLoanDefaulted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">view</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">        override</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_canLiquidateLoan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_canLiquidateLoan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token plain"> _liquidationDelay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">internal</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">view</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain">        Bid </span><span class="token keyword" style="color:rgb(127, 219, 202)">storage</span><span class="token plain"> bid </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Make sure loan cannot be liquidated if it is not active</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">state </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> BidState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ACCEPTED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bidDefaultDuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">block</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">            _liquidationDelay </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">lastRepaidTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">25</span><span class="token plain">            bidDefaultDuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">_bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">26</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div>
<p class="css-z0logh">The value for <code class="css-zezy6m">bidDefaultDuration</code> is set during the bid submission and is taken from the <code class="css-zezy6m">marketRegistry</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L376" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L376</a></p>
<p class="css-z0logh">This value is controlled by the owner of the market:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L487-L511" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L487-L511</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">An honest user doing its repayment every cycle may be considered defaulted if the market parameters allow it. This could be done by a mischievous market owner but also as a mistake. This will result in a borrower loan being defaulted and the borrower losing its collateral to the lender (or in the worst case to a liquidator) while the borrower honestly attempted to repay its loan.</p>
<p class="css-z0logh">I expected values for the payment cycle to be close to a week and default duration close to a month, however by checking the live contracts on mainnet in the MarketRegistry for <code class="css-zezy6m">marketId = 3</code> I see: <code class="css-zezy6m">paymentCycle = PaymentDefaultDuration = 2592000 (720 hours)</code>. I see similar values for other market id.</p>
<p class="css-z0logh"><a href="https://etherscan.io/address/0x5e30357d5136Bc4BfaDBA1ab341D0da09Fe7a9F1#readProxyContract" class="css-1diwg7s">https://etherscan.io/address/0x5e30357d5136Bc4BfaDBA1ab341D0da09Fe7a9F1#readProxyContract</a></p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Consider a loan as defaulted only when the last payment has been made <code class="css-zezy6m">PaymentDefaultDuration</code> after it was due. Otherwise make sure market owners cannot set <code class="css-zezy6m">PaymentDefaultDuration</code> below <code class="css-zezy6m">paymentCycle</code>.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: Fee on transfer tokens not handled</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The contest details state:</p>
<style data-emotion="css 1loxung">.css-1loxung{border-left-color:var(--theme-ui-colors-primary);border-left-style:solid;border-left-width:4px;margin-left:0;margin-right:0;padding-left:2rem;}.css-1loxung p{font-style:italic;}</style><style data-emotion="css m9jm23">.css-m9jm23{border-left-color:var(--theme-ui-colors-primary);border-left-style:solid;border-left-width:4px;margin-left:0;margin-right:0;padding-left:2rem;border-left-color:var(--theme-ui-colors-primary);border-left-style:solid;border-left-width:4px;margin-left:0;margin-right:0;padding-left:2rem;}.css-m9jm23 p{font-style:italic;}.css-m9jm23 p{font-style:italic;}</style><blockquote class="css-m9jm23">
<p class="css-z0logh">ERC20: any
ERC721: any
ERC777: none
ERC1155: any
FEE-ON-TRANSFER: any</p>
</blockquote>
<p class="css-z0logh">However, contracts throughout the system do not take into account the potential fee paid for fee on transfer tokens. I.e. they do not use the balance of the receiving contract before/after transfer to compute the actual transferred value or do not provide for the potential fee.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">In <code class="css-zezy6m">TellerV2</code> the transfer of the loan ERC20 token does not take into account a transfer fee:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L513-L540" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L513-L540</a>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L747-L751" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L747-L751</a></p>
<p class="css-z0logh">Same in <code class="css-zezy6m">CollateralManager</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L316-L386" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L316-L386</a></p>
<p class="css-z0logh">Same in <code class="css-zezy6m">CollateralEscrowV1._depositCollateral</code>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L111-L149" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L111-L149</a></p>
<p class="css-z0logh">And <code class="css-zezy6m">CollateralEscrowV1._withdrawCollateral</code>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L158-L194" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L158-L194</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">If using fee on transfer tokens, recipient of the loan / protocol fee / market fee will receive less token than anticipated through <code class="css-zezy6m">TellerV2</code>.</p>
<p class="css-z0logh">If using fee on transfer tokens for collateral, the <code class="css-zezy6m">CollateralManager</code> will attempt to withdraw a set amount from the borrower and transfer that same amount to the escrow. If fees were taken, the whole amount will not be available to the <code class="css-zezy6m">CollateralManager</code> and the transfer will fail.</p>
<p class="css-z0logh">If fees only occur on certain transfer or do not occur for multiple transfers in a transaction, it can be that the <code class="css-zezy6m">CollateralManager</code> successfully transfer the collateral to the escrow and loan is open, but the borrower / lender / liquidator will not be able to withdraw its collateral from the escrow (via <code class="css-zezy6m">CollateralManager</code>) when the loan is repaid / defaulted / liquidated due to the fee.</p>
<p class="css-z0logh">The result is an impossibility to use the protocol and a loss of funds under certain conditions for the borrower / lender / liquidator.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Explicitly state that you do not support fee on transfer tokens. Otherwise, check the balance of the receiving token before and after the transfer to compute the actual transferred value. This value needs to be stored for example in the escrow contract / collateral manager to be re-used during <code class="css-zezy6m">_withdraw()</code> to send back the correct amount.</p>
<p class="css-z0logh">If you decide to support fee on transfer tokens, please note that an attack vector is also present in the repayment of a loan on <code class="css-zezy6m">TellerV2</code> where the borrower repays amount small enough that the whole fee covers the transfer and the lender receives (almost) no token back.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: Racing condition in between withdrawing a defaulted loan collateral and repaying the loan</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">There is a racing condition in between the repayment of a late loan and the withdrawal of the collateral at stake by the lender.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The function to withdraw collateral from a loan <code class="css-zezy6m">CollateralManager.withdraw()</code> does not update the state of the bid.</p>
<p class="css-z0logh">When a loan is defaulted, the user may realise they are late on payment and attempt to repay their loans. It could also be that chain congestion introduces delay in the user transaction and the user submitted the transaction when loan was not yet defaulted.</p>
<p class="css-z0logh">If the lender (or anyone) calls <code class="css-zezy6m">CollateralManager.withdraw()</code> at the same time (or as an evil front-run), the collateral will be sent to the lender.</p>
<p class="css-z0logh">If the user only repays part of the loan, they are not entitled to withdraw their collateral and the <code class="css-zezy6m">TellerV2</code> contract will not interact with the <code class="css-zezy6m">CollateralManager</code>. As a result, the borrower will repay debt towards the lender for a defaulted loan for which the collateral has already been withdrawn.</p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Borrower may repay defaulted loans if they send transactions close to the due date or after it. The defaulted loan may already have been liquidated by the lender. This is a loss of funds for the borrower.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<p class="css-z0logh">The _repayLoan() function does not check if loan is defaulted or if the collateral has been withdrawn, unless <code class="css-zezy6m">paymentAmount &gt;= _owedAmount</code> and <code class="css-zezy6m">_shouldWithdrawCollateral == true</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L712-L762" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L712-L762</a></p>
<p class="css-z0logh">CollateralManager.withdraw() does not update the status of the loan on TellerV2:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L250-L260" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/CollateralManager.sol#L250-L260</a></p>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Prevent borrower to repay defaulted loan by calling <code class="css-zezy6m">isLoanDefaulted()</code> and reverting when true.</p>
<p class="css-z0logh">Otherwise, when they repay their loans check if the collateral has already been withdrawn. You can do this for example by adding a boolean mapping <code class="css-zezy6m">withdrawn[bidId]</code> on <code class="css-zezy6m">CollateralManager</code>.</p>
<p class="css-z0logh">The most intuitive fix would be to update the bid state to <code class="css-zezy6m">LIQUIDATED</code> when collateral is withdrawn, but that requires the CollateralManager to call the TellerV2, or to move the <code class="css-zezy6m">withdraw</code> function from CollateralManager to TellerV2. <code class="css-zezy6m">withdraw()</code> would set the status of the loan to PAID / LIQUIDATED and call <code class="css-zezy6m">CollateralManager._withdraw()</code>.</p>
<hr class="css-1ve732v"/>
<p class="css-z0logh">CollateralManager.withdraw function lacks access control</p>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">There is no access control on <code class="css-zezy6m">CollateralManager.withdraw()</code>, the function can be called by anyone.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">The function checks if loan is paid and sends the collateral to borrower. If loan is defaulted, the function sends the collateral to lender.</p>
<p class="css-z0logh">However, the protocol implemented a liquidation feature that allows others to liquidate a loan by repaying the lent token to the lender and getting the collateral in exchange.</p>
<p class="css-z0logh">It could be that a loan is defaulted and that a lender awaits for the 24 hours grace period before others can liquidate the loan and a griefer calls <code class="css-zezy6m">CollateralManager.withdraw()</code>, directly sending the collateral to the lender.</p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">Lender cannot use the liquidation feature of the protocol and is forced to receive the collateral.</p>
<p class="css-z0logh">If the collateral uses tokens with limited number of transfers or fee on transfer, this results in a direct loss for the lender.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<p class="css-z0logh">withdraw() function with no access control:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L84-L103" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/escrow/CollateralEscrowV1.sol#L84-L103</a></p>
<p class="css-z0logh">liquidateLoanFull() has a 24 hour grace period due to the <code class="css-zezy6m">LIQUIDATION_DELAY</code> used in <code class="css-zezy6m">isLoanLiquidateable</code>:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L676-L704" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L676-L704</a>
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L938-L945" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/TellerV2.sol#L938-L945</a></p>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Only allow lender to call <code class="css-zezy6m">withdraw()</code> when the loan is defaulted. Probably a good idea to only allow borrower to call <code class="css-zezy6m">withdraw()</code> when the loan is paid.</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: lenderAcceptBid vulnearble to changes in market fees</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The details for the audit state:</p>
<blockquote class="css-m9jm23">
<p class="css-z0logh">Market owners should NOT be able to race-condition attack borrowers or lenders by changing market settings while bids are being submitted or accepted (while tx are in mempool). Care has been taken to ensure that this is not possible (similar in theory to sandwich attacking but worse as if possible it could cause unexpected and non-consentual interest rate on a loan) and further-auditing of this is welcome.</p>
</blockquote>
<p class="css-z0logh">However, the market fee parameter can be abused by market owner to steal most of the loan amount paid by lender.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">In <code class="css-zezy6m">lenderAcceptBid()</code> the fee paid by lender is taken from marketPlace:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lenderAcceptBid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> _bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        amountToMarketplace </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loanDetails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">principal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">percent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">            marketRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getMarketplaceFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">marketplaceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        amountToBorrower </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain">            bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loanDetails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">principal </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">            amountToProtocol </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            amountToMarketplace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//transfer fee to marketplace</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loanDetails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lendingToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">safeTransferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">            sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">            marketRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getMarketFeeRecipient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">marketplaceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain">            amountToMarketplace</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">        </span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//transfer funds to borrower</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">loanDetails</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lendingToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">safeTransferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">            sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain">            bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">receiver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">            amountToBorrower</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></code></pre></div>
<p class="css-z0logh">The fee parameters taken from marketRegistry is controlled by the market owner:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L621-L630" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L621-L630</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">If the value of the market place fee changes in between the time the bid is submitted and the time it is accepted, the borrower will receive less / more token than anticipated.</p>
<p class="css-z0logh">An evil market owner can set the value of the marketplace fee to <code class="css-zezy6m">100% - protocolFeesPercent</code> when a lender accept a loan to steal all the loan amount. This results in a loss of funds for the borrower (borrower is supposed to repay something they did not receive) .</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Take fee percent parameter as input of <code class="css-zezy6m">_submitBid()</code> and compare them to the values in <code class="css-zezy6m">marketRegistry</code> to make sure borrower agrees with them, revert if they differ. Store the values in the bid parameters and do not consult <code class="css-zezy6m">marketRegistry</code> when loan is accepted (or revert when fee values differ).</p>
<hr class="css-1ve732v"/>
<h1 class="css-cha28j">Medium: Bid submission vulnerable to market parameters changes</h1>
<h2 class="css-1h962gv">Summary</h2>
<p class="css-z0logh">The details for the audit state:</p>
<blockquote class="css-m9jm23">
<p class="css-z0logh">Market owners should NOT be able to race-condition attack borrowers or lenders by changing market settings while bids are being submitted or accepted (while tx are in mempool). Care has been taken to ensure that this is not possible (similar in theory to sandwich attacking but worse as if possible it could cause unexpected and non-consentual interest rate on a loan) and further-auditing of this is welcome.</p>
</blockquote>
<p class="css-z0logh">However, there is little protection in place to protect the submitter of a bid from changes in market parameters.</p>
<h2 class="css-1h962gv">Vulnerability Detail</h2>
<p class="css-z0logh">In _submitBid(), certain bid parameters are taken from the <code class="css-zezy6m">marketRegistry</code>:</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="prism-code language-solidity" data-linenumber="true"><button type="button" name="copy code to clipboard" class="code-copy-button css-ce1lkk">Copy<span aria-roledescription="status" class="css-15vf505">copy code to clipboard</span></button><code class="code-content language-solidity"><div class="token-line" style="color:#d6deeb"><span class="line-number-style">1</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_submitBid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">2</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">3</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">terms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">paymentCycle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bidPaymentCycleType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> marketRegistry</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">4</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getPaymentCycle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_marketplaceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">6</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">terms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">APR </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> _APR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">8</span><span class="token plain">        bidDefaultDuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> marketRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getPaymentDefaultDuration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">9</span><span class="token plain">            _marketplaceId</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">10</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">12</span><span class="token plain">        bidExpirationTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> marketRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getBidExpirationTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">13</span><span class="token plain">            _marketplaceId</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">14</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">16</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">paymentType </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> marketRegistry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getPaymentType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_marketplaceId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">17</span><span class="token plain">        </span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">18</span><span class="token plain">        bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">terms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">paymentCycleAmount </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> V2Calculations</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">19</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">calculatePaymentCycleAmount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">20</span><span class="token plain">                bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">paymentType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">21</span><span class="token plain">                bidPaymentCycleType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">bidId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">22</span><span class="token plain">                _principal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">23</span><span class="token plain">                _duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">24</span><span class="token plain">                bid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">terms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">paymentCycle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">25</span><span class="token plain">                _APR</span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">26</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="line-number-style">27</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></code></pre></div>
<p class="css-z0logh">All the parameters taken from marketRegistry are controlled by the market owner:
<a href="https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L487-L511" class="css-1diwg7s">https://github.com/sherlock-audit/2023-03-teller/blob/main/teller-protocol-v2/packages/contracts/contracts/MarketRegistry.sol#L487-L511</a></p>
<h2 class="css-1h962gv">Impact</h2>
<p class="css-z0logh">If market parameters are changed in between the borrower submitting a bid transaction and the transaction being applied, borrower may be subject to changes in <code class="css-zezy6m">bidDefaultDuration</code>, <code class="css-zezy6m">bidExpirationTime</code>, <code class="css-zezy6m">paymentType</code>, <code class="css-zezy6m">paymentCycle</code>, <code class="css-zezy6m">bidPaymentCycleType</code> and <code class="css-zezy6m">paymentCycleAmount</code>.</p>
<p class="css-z0logh">That is, the user may be committed to the bid for longer / shorter than expected. They may have a longer / shorter default duration (time for the loan being considered defaulted / eligible for liquidation). They have un-provisioned for payment type and cycle parameters.</p>
<p class="css-z0logh">I believe most of this will have a medium impact on borrower (mild inconveniences / resolvable by directly repaying the loan) if the market owner is not evil and adapting the parameters reasonably.</p>
<p class="css-z0logh">An evil market owner can set the value of <code class="css-zezy6m">bidDefaultDuration</code> and <code class="css-zezy6m">paymentCycle</code> very low (0) so that the loan will default immediately. It can then accept the bid, make user default immediately, and liquidate the loan to steal the user&#x27;s collateral. This results in a loss of collateral for the borrower.</p>
<h2 class="css-1h962gv">Code Snippet</h2>
<h2 class="css-1h962gv">Tool used</h2>
<p class="css-z0logh">Manual Review</p>
<h2 class="css-1h962gv">Recommendation</h2>
<p class="css-z0logh">Take every single parameters as input of <code class="css-zezy6m">_submitBid()</code> (including fee percents) and compare them to the values in <code class="css-zezy6m">marketRegistry</code> to make sure borrower agrees with them, revert if they differ.</p></section></main><style data-emotion="css y7pay1">.css-y7pay1{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-top:8rem;color:var(--theme-ui-colors-secondary);-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-top-style:solid;border-top-width:1px;border-top-color:var(--theme-ui-colors-divide);padding-top:1rem;}.css-y7pay1 a{color:var(--theme-ui-colors-secondary);-webkit-text-decoration:none;text-decoration:none;}.css-y7pay1 a:hover{color:var(--theme-ui-colors-heading);-webkit-text-decoration:underline;text-decoration:underline;}.css-y7pay1 a:focus{color:var(--theme-ui-colors-heading);}@media screen and (min-width: 640px){.css-y7pay1{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media screen and (min-width: 768px){.css-y7pay1{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><footer class="css-y7pay1"><div>© <!-- -->2023<!-- --> by <!-- -->cducrest Blog<!-- -->. All rights reserved.</div><div><a aria-label="Link to the theme&#x27;s GitHub repository" href="https://github.com/LekoArts/gatsby-themes/tree/main/themes/gatsby-theme-minimal-blog" class="css-aizfxq">Theme</a> <!-- -->by<!-- --> <a aria-label="Link to the theme author&#x27;s website" href="https://www.lekoarts.de?utm_source=minimal-blog&amp;utm_medium=Theme" class="css-aizfxq">LekoArts</a></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/teller-audit-result";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-b6a156a42dfa67a97032.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-blog-query-tsx-cd92bbe5e899964d6fc4.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-about-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-about-index-mdx-fe0d603021be5cbffdbf.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-knowledge-references-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-page-query-tsx-content-file-path-content-pages-knowledge-references-index-mdx-a093c1ae5f1dd181b66f.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-ajna-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-ajna-report-index-mdx-ef679ccc4225f03e894b.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-blueberry-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-blueberry-report-index-mdx-d4adff4125103bff6fc4.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-experience-wrong-interface-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-experience-wrong-interface-index-mdx-bc7e6c6f68b0cea6dff4.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-hats-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-hats-report-index-mdx-e10a5c5b73d14658af98.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-olympus-dao-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-olympus-dao-report-index-mdx-49d36b98daa9d9d80636.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-olympus-dao-update-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-olympus-dao-update-report-index-mdx-5a0ff33b1c647e1a36f3.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-taurus-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-taurus-report-index-mdx-d3e30fe6b79d5d713d70.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-teller-report-index-mdx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-teller-report-index-mdx-fdff5f91caaf3af7b7ad.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tag-query-tsx-67a06325f1eddac62be8.js\"],\"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx\":[\"/component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-tags-query-tsx-5e84ef6f0b172498c730.js\"],\"component---src-lekoarts-gatsby-theme-minimal-blog-core-templates-homepage-query-tsx\":[\"/component---src-lekoarts-gatsby-theme-minimal-blog-core-templates-homepage-query-tsx-9876696b18d846a831fd.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-abb9a0d994ab633d7be8.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="81a4703eb552c9db082f";</script><script src="/auditor-blog/webpack-runtime-6529ae0bbd14a9f85511.js" async></script><script src="/auditor-blog/framework-f689a2a97f4fb6f27065.js" async></script><script src="/auditor-blog/app-b6a156a42dfa67a97032.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>